# DHKim ROBOTIS Firmward 강좌 정리
 * 20190601~02 이틀간 마곡 로보티즈 Firmware설계 교육 정리
 * Orignal From "Baram님" 
     1. [Baram님 네이버 블로그 주소](https://blog.naver.com/chcbaram/221337996036)
     2. [Baram님 깃허브 주소](https://github.com/chcbaram)
# 1. 펌웨어 구조 설계의 필요성
 * 제조사 라이브러리에 의존하지 않는(MCU벤더에 의해 코가 꿰이는 상황이 발생하지 않도록) 제조사에서 제공하는 라이브러리와 어플리케이션 사이에 하나의 레이어 추가하기가 핵심
 * 기능을 구현하기 위한 인터페이스는 공통으로 가져가는것 - 스위치, LED, UART, Print, USB...
 * MCU 의존적인 부분(레지스터, 제조사 라이브러리, 링커스크립트, 스타트업 코드)는 최대한 한쪽으로 몰고 함수Rapping, 공통인터페이스 함수를 통해 추상화 (Static, get함수, Set함수, 함수포인터를 잘 사용하면 어렵지않음)
 * But! 개발을 하다보면 펌웨어의 구조 자체가 제작프로젝트의 목표와 맞지 않을 수 있다. 이렇다고 해서 갈아엎는것은 더 위험
 * 최고로 최선의 노력을 다해야할것은 기능의 구현! 동작하는 코드를 짜자
 * 다음으로 고려해야 할 부분이 구조임
 * 실력없는(못하는) 사람의 펌웨어를 인수인계 받아 유지보수 하는게 가장 힘듬
 * 확장성, 재 사용성을 생각하고 프로그래밍을 하자
# 2. MCU 개발 노하우
 * 제조사가 제공해주는(칩벤더) Application Note를 잘 확인해보고 많이 보다보면 어떤걸 만들 수 있겠다 하는 아이디어가 떠오를 것임
 * 정말 동작해야되는데 정 안된다 싶을 때 Errata Sheet 를 참고해보기, 물리적으로 해결할 수 없는 버그나 , 버전별 알려진 버그에 관한 사항과 회피방안이 정리되어있음.
 * C++ 로도 MCU펌웨어를 짜는 추세이며, C보다는 고려해야 할 사항이 많음(Constructor, Distrcutor, CopyCon, Class, Object생성, Virtual함수 등등.. )
 * C++의 장점으로는 객체지향적이며, 런타임에 결정할 수 있는 하드웨어(예를들어 모터가 장착되지만, 어떤 모터가 장착될 지 모를때, C++는 C보다 효율성 높게 런타임에 하드웨어 변경해 갈 수 있다.)
 * 함수포인터를 적절하게 사용하여 성능을 높여보자
# 3. 기술적인 포인트
 * 단순 LED블링크도 blocking delay사용하지 말고 non-block blink로 짜자.
 * millis를 사용해도 되고 인터럽트 사용도 좋음.
 * 리눅스의 u-boot DFU등 부트로더 비슷한것들은 모조리 문제 발생시 매우 치명적이다. 따라서 엔지니어 전체 커리어에서 담당하지 못할 가능성도 있다. 특히 신입이나 경력이 짧은 직원이 부트로더를 직접 제작해야 할 일은 적다.
 * (우리가 원자력발전소에 관여하지 않아도 전기를 지금이순간도 쓰고있는 것 처럼) 부트로더는 임베디드 분야에 어려우면서 핵심적인 분야이기에 이 강좌를 통해 배울수 있어 정말 좋다!!
 * (부트로더 나쁜예) - 부트로더에 실수로 모터관련 핀이 오동작하여, Fuse절단사고 일어남 ->> 이만큼 위험하고 크리티컬 한 일이니 주의하자
 * Protocol 구성후 PC와 연동되어 통신 할 때는, State machine구조로 설계하니 정말 좋아보인다 -> 디자인패턴에 대해 알아보자
 * 통신이기에 항상 예외적인 상황이 발생한다. 이런 예외처리 방법론
   1. Timeout 기반 설계
   2. Responce 기반 설계
   3. CRC
   4. 스터핑
    * 이외에도 많으므로 각자 사용목적에 맞추어 사용하자. 각 항목들은 Mutual exclusive하지는 않다.
 * 프로그래머(특히 펌웨어 분야 엔지니어는) 분야가 다양하다 
   1. 소비자향(메이커가 직접 만들어 소비자에게 판매하는 것들..), 인더스트리 제품군(국방, 자동차 등등..), B2B납품(예를들어 삼성가전에 납품하는 셋트)
   2. AP(MPU사용), MCU 인지
   3. 제품에 따라 완전히 다름(같은 자동차에 들어가더라도 실내 인포테인먼트와 엔진제어기가 다르듯이)
 * 좀더 인정받는 엔지니어가 되기 위해서는 
   1. 개발 성공 가능성의 확신 -> 일련의 과정을 따라 어느정도의 시간이 투입 시 필연적으로 동작 할수밖에 없는 확신
   2. 문제에 대한 경험과 문제해결능력, 판단
   3. 가장 중요한것 : 동작이 잘되도록(기능구현)
   4. 코드를 누군가가 본다했을 때 부끄럽지 않은 수준으로!


# 4.  부트로더
 * Flash와 RAM 의 공간 구획(Section)에 대한 이해 진행
 * 부트로더 설정에 주요 펙터 들
   1. 인터럽트(Vector)
   2. 링커
   3. Bootloader기능
 * 부트로더에서 펌웨어로의 점프는 이중함수 포인터!

# 5. My To Do List
  * 디자인패턴 공부
  * 펌웨어든 소프트웨어든 많이 짜보자
  * F746Disco보드로 공부해보자
  * Atmega프로젝트 빨리 끝내자
  * 디지털 필터 공부해보자
  * EABI : (Embedded Application Binary Interface) 변수, 레지스터, 스택, 명령어, 자료형의 표준 변환 정의  (요약) : ARM 컴파일러가 고려 해야 할 표준
# 6. 부트로더 활용 개발 방법 정의 
  * 부트로더 활용한 펌웨어 개발
    1. VECTOR 주소 변경(System_stm32f7xx.c)
    2. (bootloader에서) 부트로더 모드 진입 조건문과 부트모드 접근 아닐때 펌웨어의 주소로 Jump하면 됨. 주의사항으로는 Peri들 Deinit 필수 (특히 USB, UART, 모터, LED등등..)
    3. Linker에서 부트로더&펌웨어의 의 길이(사이즈)와 시작주소 설정
